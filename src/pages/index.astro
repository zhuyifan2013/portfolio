---
import BaseLayout from '../layouts/BaseLayout.astro';
import HomeSection from '../components/HomeSection.astro';
import PostList from '../components/PostList.astro';
import NoteList from '../components/NoteList.astro';
import ProjectList from '../components/ProjectList.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('posts')).filter((item) => !item.data.draft).sort(
  (a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf()
);
const notes = (await getCollection('notes')).sort(
  (a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf()
);
const projects = (await getCollection('projects')).sort(
  (a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf()
);

const latestNotes = notes.slice(0, 5);
const latestProjects = projects.slice(0, 5);
---

<BaseLayout title="Portfolio · Yifan Zhu" description="Projects, posts, and notes built with Astro">
  <section class="intro panel">
    <p class="eyebrow">Portfolio / 技术博客</p>
    <h1>Calm dashboard of work, writing, and fragments.</h1>
    <p class="muted">
      Low-saturation layout that surfaces long-form posts, quick notes, and current projects. Built in
      Astro with content collections.
    </p>
  </section>

  <div class="dashboard">
    <HomeSection title="Posts" href="/posts/">
      <PostList posts={posts} />
    </HomeSection>

    <div class="right-column">
      <HomeSection title={`Notes (${notes.length})`} href="/notes/">
        <NoteList notes={latestNotes} />
      </HomeSection>

      <HomeSection title="Projects" href="/projects/">
        <ProjectList projects={latestProjects} />
      </HomeSection>
    </div>
  </div>
</BaseLayout>

<style>
  .intro {
    padding: 18px 18px 16px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-bottom: 18px;
  }

  h1 {
    margin: 0;
    font-size: clamp(1.5rem, 2.6vw, 2.3rem);
    letter-spacing: -0.02em;
  }

  .eyebrow {
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-size: 0.78rem;
    color: var(--accent);
    margin: 0;
  }

  .dashboard {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 22px;
    align-items: start;
  }

  .right-column {
    display: flex;
    flex-direction: column;
    gap: 18px;
  }

  @media (max-width: 1024px) {
    .dashboard {
      grid-template-columns: 1fr;
    }

    .right-column {
      gap: 14px;
    }
  }
</style>
