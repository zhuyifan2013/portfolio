---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

type Props = {
  project: CollectionEntry<'projects'>;
};

const { project } = Astro.props as Props;
const { Content } = await project.render();
---

<BaseLayout title={`${project.data.title} · Projects`} description={project.data.description}>
  <article class="article panel">
    <div class="meta">
      <span class="pill">{project.data.status}</span>
      <span class="muted">Started {project.data.publishedAt.toISOString().slice(0, 10)}</span>
    </div>
    <h1>{project.data.title}</h1>
    {project.data.description && <p class="muted">{project.data.description}</p>}
    <div class="links">
      {project.data.demo && (
        <a class="link" href={project.data.demo} target="_blank" rel="noreferrer">Demo ↗</a>
      )}
      {project.data.repo && (
        <a class="link" href={project.data.repo} target="_blank" rel="noreferrer">Repo ↗</a>
      )}
    </div>
    {project.data.stack.length > 0 && (
      <div class="tags">
        {project.data.stack.map((tag) => (
          <span class="tag">{tag}</span>
        ))}
      </div>
    )}
    <div class="content">
      <Content />
    </div>
  </article>
</BaseLayout>

<style>
  .meta {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--muted);
    font-size: 0.95rem;
  }
  .links {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin: 8px 0 10px;
  }
  .link {
    color: var(--accent);
  }
  .tags {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin: 8px 0 14px;
  }
  .tag,
  .pill {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    padding: 4px 10px;
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid var(--border);
    color: var(--muted);
    font-size: 0.85rem;
  }
  .pill {
    text-transform: capitalize;
    color: var(--accent);
    border-color: rgba(34, 197, 94, 0.5);
  }
  .content :global(code) {
    background: rgba(255, 255, 255, 0.06);
    padding: 2px 6px;
    border-radius: 6px;
    font-size: 0.95rem;
  }
  .content :global(pre) {
    background: #0b0f16;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px;
    overflow-x: auto;
  }
  .muted {
    color: var(--muted);
  }
</style>
